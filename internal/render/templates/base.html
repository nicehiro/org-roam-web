{{define "base"}}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{block "title" .}}{{.Site.Title}}{{end}}</title>
  <base href="{{.Site.BaseURL}}/">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <style>
    :root {
      --bg-primary: #0f0f0f;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #242424;
      --text-primary: #e1e4e8;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --accent: #7c8aff;
      --accent-hover: #9ba3ff;
      --border: #30363d;
      --tag-bg: #21262d;
      --tag-text: #8b949e;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f6f8fa;
        --bg-tertiary: #eaeef2;
        --text-primary: #1f2328;
        --text-secondary: #656d76;
        --text-muted: #8c959f;
        --accent: #5a67d8;
        --accent-hover: #4c51bf;
        --border: #d0d7de;
        --tag-bg: #eaeef2;
        --tag-text: #656d76;
      }
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      color: var(--accent-hover);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* Header */
    .header {
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .site-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .nav-links {
      display: flex;
      gap: 1.5rem;
    }

    .nav-links a {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .nav-links a:hover {
      color: var(--text-primary);
    }

    /* Tags */
    .tag {
      display: inline-block;
      padding: 0.125rem 0.5rem;
      background: var(--tag-bg);
      color: var(--tag-text);
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Links */
    .internal-link {
      color: var(--accent);
    }

    .internal-link .link-marker {
      opacity: 0.5;
      margin-right: 0.125rem;
    }

    .external-link {
      color: var(--text-secondary);
      text-decoration: underline;
      text-decoration-style: dotted;
    }

    /* Search */
    .search-container {
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      padding-right: 3rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-shortcut {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      padding: 0.125rem 0.375rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: monospace;
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 0.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      max-height: 400px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }

    .search-results.active {
      display: block;
    }

    .search-result {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
    }

    .search-result:last-child {
      border-bottom: none;
    }

    .search-result:hover,
    .search-result.selected {
      background: var(--bg-tertiary);
    }

    .search-result-title {
      color: var(--text-primary);
      font-weight: 500;
    }

    .search-result-tags {
      margin-top: 0.25rem;
    }

    /* ============================================
       CODE BLOCKS - Enhanced styling
       ============================================ */
    
    /* Code block container (go-org outputs: .src.src-{lang} > .highlight > pre) */
    .src {
      position: relative;
      margin: 1.5rem 0;
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .src .highlight {
      margin: 0;
    }

    .src pre {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 1rem;
      padding-top: 2rem; /* Space for language label */
      overflow-x: auto;
      font-size: 0.875rem;
      margin: 0;
    }

    /* Language label */
    .src::before {
      content: attr(data-lang);
      position: absolute;
      top: 0;
      left: 0;
      padding: 0.25rem 0.75rem;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      color: var(--text-muted);
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
      border-right: 1px solid var(--border);
      border-radius: 0 0 0.375rem 0;
      z-index: 1;
    }

    /* Copy button */
    .code-copy-btn {
      position: absolute;
      top: 0.375rem;
      right: 0.5rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.6875rem;
      font-family: inherit;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      color: var(--text-muted);
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.15s, background 0.15s;
      z-index: 2;
    }

    .src:hover .code-copy-btn {
      opacity: 1;
    }

    .code-copy-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .code-copy-btn.copied {
      color: var(--accent);
    }

    /* Line numbers for blocks > 5 lines */
    .src.has-line-numbers pre {
      padding-left: 3.5rem;
    }

    .src.has-line-numbers .line-number {
      position: absolute;
      left: 0;
      width: 2.5rem;
      padding-right: 0.75rem;
      text-align: right;
      color: var(--text-muted);
      font-size: 0.75rem;
      user-select: none;
      opacity: 0.6;
    }

    /* Terminal style for shell/bash */
    .src-shell pre,
    .src-bash pre,
    .src-sh pre {
      background: #0d1117;
    }

    .src-shell::before,
    .src-bash::before,
    .src-sh::before {
      background: #161b22;
    }

    /* Fallback for plain pre without .src wrapper */
    pre:not(.src pre) {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      font-size: 0.875rem;
    }

    code {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    }

    /* Inline code */
    :not(pre) > code {
      background: var(--bg-tertiary);
      padding: 0.15rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.875em;
      color: var(--accent);
    }

    /* Don't color code inside pre */
    pre code {
      background: transparent;
      padding: 0;
      color: inherit;
    }

    /* Images */
    img {
      max-width: 100%;
      height: auto;
      border-radius: 0.5rem;
    }

    /* Blockquote */
    blockquote {
      border-left: 3px solid var(--border);
      padding-left: 1rem;
      margin: 1rem 0;
      color: var(--text-secondary);
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    th, td {
      padding: 0.5rem;
      border: 1px solid var(--border);
      text-align: left;
    }

    th {
      background: var(--bg-secondary);
      font-weight: 600;
    }

    /* ============================================
       LISTS - Enhanced styling
       ============================================ */
    
    ul, ol {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }

    li {
      margin: 0.375rem 0;
      line-height: 1.6;
    }

    li > p {
      margin: 0.25rem 0;
    }

    /* Custom bullet styles for unordered lists */
    .note-content ul {
      list-style: none;
      padding-left: 1.25rem;
    }

    .note-content ul > li {
      position: relative;
      padding-left: 0.5rem;
    }

    .note-content ul > li::before {
      content: "•";
      position: absolute;
      left: -0.875rem;
      color: var(--text-muted);
    }

    /* Nested list bullets */
    .note-content ul ul > li::before {
      content: "◦";
    }

    .note-content ul ul ul > li::before {
      content: "▪";
      font-size: 0.75em;
    }

    /* Ordered lists */
    .note-content ol {
      padding-left: 1.5rem;
    }

    .note-content ol > li {
      padding-left: 0.25rem;
    }

    .note-content ol > li::marker {
      color: var(--text-muted);
      font-weight: 500;
    }

    /* Checkbox lists */
    .note-content li input[type="checkbox"] {
      margin-right: 0.5rem;
      accent-color: var(--accent);
      transform: scale(1.1);
    }

    /* ============================================
       INLINE STYLING - Bold, Underline, etc.
       ============================================ */
    
    /* Bold with * marker */
    .note-content strong {
      font-weight: 700;
      color: var(--text-primary);
    }

    .note-content strong::before {
      content: "*";
      color: var(--text-muted);
      font-weight: 400;
      font-size: 0.7em;
      margin-right: 0.1em;
      opacity: 0.5;
      vertical-align: baseline;
    }

    /* Emphasis/Underline with _ markers */
    .note-content em {
      font-style: normal;
      text-decoration: underline;
      text-decoration-color: var(--accent);
      text-decoration-thickness: 1.5px;
      text-underline-offset: 2px;
    }

    .note-content em::before,
    .note-content em::after {
      content: "_";
      color: var(--text-muted);
      font-size: 0.7em;
      opacity: 0.5;
      text-decoration: none;
    }

    /* ============================================
       ORG BLOCKS - Center, Example, etc.
       ============================================ */
    
    /* Center block */
    .center-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1.5rem 0;
      text-align: center;
    }

    /* Example block */
    .example {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent);
      border-radius: 0 0.375rem 0.375rem 0;
      padding: 1rem;
      margin: 1rem 0;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.875rem;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    /* ============================================
       TABLES - Enhanced styling
       ============================================ */
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 0.9rem;
    }

    th {
      background: var(--bg-secondary);
      font-weight: 600;
      text-align: left;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
    }

    td {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
    }

    /* Zebra striping */
    tbody tr:nth-child(even) {
      background: var(--bg-secondary);
    }

    tbody tr:hover {
      background: var(--bg-tertiary);
    }

    /* First row as header if no thead */
    tbody tr:first-child td {
      background: var(--bg-secondary);
      font-weight: 600;
    }

    /* ============================================
       IMAGES - Enhanced styling
       ============================================ */
    
    img {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 1.5rem auto;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    @media (prefers-color-scheme: dark) {
      img {
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
      }
    }

    /* Images in center block */
    .center-block img {
      margin: 0;
    }

    /* ============================================
       BLOCKQUOTES - Enhanced styling
       ============================================ */
    
    blockquote {
      border-left: 3px solid var(--accent);
      padding: 0.5rem 1rem;
      margin: 1.5rem 0;
      background: var(--bg-secondary);
      border-radius: 0 0.375rem 0.375rem 0;
      color: var(--text-secondary);
    }

    blockquote p {
      margin: 0.5rem 0;
    }

    blockquote p:first-child {
      margin-top: 0;
    }

    blockquote p:last-child {
      margin-bottom: 0;
    }

    /* ============================================
       MOBILE RESPONSIVE STYLES
       ============================================ */
    
    @media (max-width: 768px) {
      html {
        font-size: 15px;
      }

      .container {
        padding: 0 1rem;
      }

      /* Header */
      .header {
        padding: 1rem 0;
      }

      .header-content {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .site-title {
        font-size: 1.125rem;
      }

      .nav-links {
        gap: 1rem;
      }

      .nav-links a {
        font-size: 0.8125rem;
      }

      /* Code blocks */
      pre {
        padding: 0.75rem;
        font-size: 0.8125rem;
        border-radius: 0.375rem;
      }

      /* Tables - horizontal scroll */
      table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      th, td {
        padding: 0.375rem 0.5rem;
        font-size: 0.875rem;
        white-space: nowrap;
      }

      /* Blockquotes */
      blockquote {
        padding-left: 0.75rem;
        margin: 0.75rem 0;
      }

      /* Tags */
      .tag {
        font-size: 0.6875rem;
        padding: 0.1rem 0.375rem;
      }
    }

    /* Tablet adjustments */
    @media (min-width: 769px) and (max-width: 1024px) {
      .container {
        max-width: 900px;
      }
    }
  </style>
  {{block "head" .}}{{end}}
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <a href="{{.Site.BaseURL}}/" class="site-title">{{.Site.Title}}</a>
      <nav class="nav-links">
        <a href="{{.Site.BaseURL}}/graph.html">Graph</a>
        <a href="{{.Site.BaseURL}}/">Home</a>
      </nav>
    </div>
  </header>
  
  {{block "content" .}}{{end}}

  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    // KaTeX rendering configuration
    const katexOptions = {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\[", right: "\\]", display: true},
        {left: "\\(", right: "\\)", display: false}
      ],
      throwOnError: false
    };

    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, katexOptions);
    });

    // Helper to unescape JSON-escaped LaTeX (for graph tooltips)
    function unescapeLatex(str) {
      return str.replace(/\\\\/g, '\\');
    }

    // ============================================
    // CODE BLOCK ENHANCEMENTS
    // ============================================
    document.querySelectorAll('.src').forEach(block => {
      // Extract language from class (e.g., "src src-python" -> "python")
      const classes = block.className.split(' ');
      const langClass = classes.find(c => c.startsWith('src-') && c !== 'src');
      if (langClass) {
        block.setAttribute('data-lang', langClass.replace('src-', ''));
      }

      // Add copy button
      const copyBtn = document.createElement('button');
      copyBtn.className = 'code-copy-btn';
      copyBtn.textContent = 'Copy';
      copyBtn.addEventListener('click', () => {
        const pre = block.querySelector('pre');
        if (pre) {
          navigator.clipboard.writeText(pre.textContent).then(() => {
            copyBtn.textContent = 'Copied!';
            copyBtn.classList.add('copied');
            setTimeout(() => {
              copyBtn.textContent = 'Copy';
              copyBtn.classList.remove('copied');
            }, 2000);
          });
        }
      });
      block.appendChild(copyBtn);

      // Add line numbers if > 5 lines
      const pre = block.querySelector('pre');
      if (pre) {
        const lines = pre.textContent.split('\n');
        // Remove trailing empty line if present
        if (lines[lines.length - 1] === '') {
          lines.pop();
        }
        
        if (lines.length > 5) {
          block.classList.add('has-line-numbers');
          
          // Create line number elements
          const lineNumbers = document.createElement('div');
          lineNumbers.style.cssText = 'position: absolute; left: 0; top: 2rem; padding: 1rem 0; pointer-events: none;';
          
          lines.forEach((_, i) => {
            const lineNum = document.createElement('div');
            lineNum.className = 'line-number';
            lineNum.textContent = i + 1;
            lineNum.style.cssText = 'height: 1.5rem; line-height: 1.5rem;';
            lineNumbers.appendChild(lineNum);
          });
          
          block.style.position = 'relative';
          block.insertBefore(lineNumbers, block.firstChild);
        }
      }
    });
  </script>
  {{block "scripts" .}}{{end}}
</body>
</html>
{{end}}
